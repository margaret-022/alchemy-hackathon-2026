<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Transaction Pressure</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <img
      src="matcha_monster_branded.png"
      alt=""
      class="easter-egg"
      aria-hidden="true"
    />
    <div class="app">
      <div class="window">
        <div class="titlebar">
          <div class="titlebar-left">
            <span class="titlebar-icon">TP</span>
            <span class="titlebar-title">Transaction Pressure</span>
          </div>
          <div class="titlebar-right">
            <button class="titlebar-button help-button" id="help-button">?</button>
            <button class="titlebar-button" id="leaderboard-toggle">
              Leaderboard
            </button>
            <button class="titlebar-button" id="music-toggle">Music: On</button>
            <button class="titlebar-button" id="how-to-win-button">
              How to Win
            </button>
            <button class="titlebar-button" id="tutorial-button">Tutorial</button>
            <button class="titlebar-button" id="snake-toggle">Snake</button>
            <button class="titlebar-button debug-only" id="quick-victory">
              Show Victory
            </button>
            <button class="titlebar-button debug-only" id="quick-incident">
              Show Incident
            </button>
            <button class="titlebar-button" id="quick-restart">
              New Game
            </button>
          </div>
        </div>

        <div class="content">
          <div class="grid" id="grid"></div>
          <div class="side-panel">
            <div class="panel-section">
              <div class="panel-title">Approvals</div>
              <div class="status-label" id="approval-count">0</div>
              <div class="status-subtext">
                Goal: approve 25 without an incident.
              </div>
            </div>

            <div class="panel-section">
              <div class="panel-title tooltip">
                Request Volume
                <span class="tooltip-text">
                  Throughput pressure. Increases with every approval and rises
                  faster when you approve quickly. Waiting lowers it. High
                  volume alone can trigger an incident.
                </span>
              </div>
              <div class="meter">
                <div class="meter-fill" id="volume-meter"></div>
              </div>
            </div>

            <div class="panel-section">
              <div class="panel-title tooltip">
                Hotspot Concentration
                <span class="tooltip-text">
                  Increases when you approve similar request patterns. Repeating
                  the same type or cluster raises this bar and can trigger an
                  incident.
                </span>
              </div>
              <div class="meter">
                <div class="meter-fill" id="hotspot-meter"></div>
              </div>
            </div>

            <div class="panel-section signals-panel">
              <div class="panel-title">Time</div>
              <div class="time-row">
                <div class="status-label" id="timer-display">00:00</div>
                <div class="status-subtext" id="timer-limit">Limit: 10:00</div>
              </div>
            </div>

            <div class="panel-section signals-panel">
              <div class="panel-title">Clues</div>
              <div class="signals-content" id="signals-content">
                <span class="signal-label"
                  >Choose a tile to see a pace or sameness clue.</span
                >
              </div>
            </div>

          </div>
        </div>

        <div class="action-bar">
          <label class="toggle-row">
            <input
              type="checkbox"
              id="block-descriptions-toggle"
              class="toggle-input"
              aria-label="Show block descriptions"
            />
            <span class="toggle-label">Show tile method + selector.</span>
          </label>
          <div class="action-right">
            <div class="action-tooltip">
              <button class="mode-button" id="hold-toggle">Hold Mode: Off</button>
              <span class="tooltip-text">
                Hold lets you inspect a tile without adding pressure.
              </span>
            </div>
          </div>
        </div>

      </div>

      <div class="incident-overlay hidden" id="incident-overlay">
        <div class="incident-modal">
          <div class="incident-title">Rate Limit Incident</div>
          <div class="incident-cause" id="incident-cause"></div>
          <div class="incident-summary" id="incident-summary"></div>
          <div class="incident-hint" id="incident-hint"></div>
          <div class="incident-impact" id="incident-impact"></div>
          <div class="incident-recommendation" id="incident-recommendation"></div>
          <pre class="incident-trophy" aria-hidden="true">     _______________
    |@@@@|     |####|
    |@@@@|     |####|
    |@@@@|     |####|
    \@@@@|     |####/
     \@@@|     |###/
      `@@|_____|##'
           (O)
        .-'''''-.
      .'  * * *  `.
     :  *       *  :
    : ~ L O S E R ~ :
    : ~ A W A R D ~ :
     :  *       *  :
      `.  * * *  .'
        `-.....-'
</pre>
          <div class="incident-list" id="incident-list"></div>
          <div class="modal-actions center">
            <button class="restart-button" id="restart-button">New Game</button>
          </div>
        </div>
      </div>

      <div class="victory-overlay hidden" id="victory-overlay">
        <div class="victory-modal">
          <div class="incident-title">On-Chain Legend Unlocked</div>
          <div class="victory-subtitle">
            No 429s. No hotspots. Pure flow.
          </div>
          <pre class="victory-trophy" aria-hidden="true">       _________
      '.       .'
       _\:.   /_
      //|::   |\\
      \\|::   |//
       `\::.  /`
         `\ /`
           T
        __/ \__
       |       |
      _|SUCCESS|_
     |  ~~~~~~~  |
  ^^^^^^^^^^^^^^^^^^^</pre>
          <div class="victory-body">
            You hit the approval target while keeping Volume and Concentration in
            bounds. The mempool sings, the validators nod, and your RPC budget is
            perfectly paced.
          </div>
          <div class="leaderboard-entry">
            <div class="panel-title">Submit your run</div>
            <div class="leaderboard-row">
              <input
                type="text"
                id="leaderboard-name"
                class="leaderboard-input"
                placeholder="Display name"
                maxlength="20"
                autocomplete="nickname"
              />
              <button class="restart-button" id="leaderboard-submit">
                Submit score
              </button>
            </div>
            <div class="status-subtext" id="leaderboard-status">
              Add your name to the global leaderboard.
            </div>
          </div>
          <div class="modal-actions center">
            <button class="restart-button" id="victory-restart-button">
              New Game
            </button>
          </div>
        </div>
      </div>


      <div class="intro-overlay hidden" id="intro-overlay">
        <div class="intro-modal">
          <div class="intro-title">Transaction Pressure</div>
          <div class="intro-body">
            <p>
              You are approving normal transactions inside a windowed control
              tool. Failures are visible; causes are hidden.
            </p>
            <p>
              Every approval adds pressure. Patterns, not single tiles, create
              incidents.
            </p>
            <p class="intro-note">
              Approve tiles to proceed. Watch the grid light up with related
              activity. When the system breaks, the postmortem reveals what
              accumulated most.
            </p>
          </div>
          <div class="intro-actions">
            <button class="restart-button" id="intro-tutorial-button">
              View Tutorial
            </button>
            <button class="restart-button" id="intro-start-button">
              Begin Game
            </button>
          </div>
        </div>
      </div>

      <div class="help-overlay hidden" id="help-overlay">
        <div class="help-modal">
          <button class="modal-close" id="help-close-button">✕</button>
          <div class="intro-title">How to Read the Panel</div>
          <div class="intro-body">
            <h4>Time</h4>
            <p>
              This is the round clock. You are trying to reach the approval goal
              before the limit expires.
            </p>
            <h4>Request Volume</h4>
            <p>
              Throughput pressure. Approving quickly or in bursts raises it,
              even if the requests are diverse.
            </p>
            <h4>Hotspot Concentration</h4>
            <p>
              Repetition pressure. Approving similar request types or clusters
              increases it and can trigger incidents through sameness.
            </p>
            <h4>Approvals</h4>
            <p>
              Your progress toward the goal. More approvals raise pressure, so
              pacing and variety both matter.
            </p>
            <h4>Signals</h4>
            <p>
              What the system is “telling” you. Signals reveal severity and
              related approvals after each choice.
            </p>
            <h4>Clues</h4>
            <p>
              Clues explain the pressure you just added. They call out pacing
              (burst approvals) or sameness (repeat method or cluster) so you can
              adjust the next few choices.
            </p>
            <h4>Hold Mode</h4>
            <p>
              Use Hold Mode to inspect a tile without adding pressure. It marks
              the tile for later and keeps meters steady while you compare
              patterns.
            </p>
            <h4>The Grid</h4>
            <p>
              Each tile is a request with a hidden pattern. Approving reveals
              how choices stack into incidents.
            </p>
          </div>
        </div>
      </div>

      <div class="leaderboard-overlay hidden" id="leaderboard-overlay">
        <div class="leaderboard-modal">
          <button class="modal-close" id="leaderboard-close-button">✕</button>
          <div class="intro-title">Leaderboard</div>
          <div class="intro-body">
            <table class="leaderboard-table" aria-label="Leaderboard">
              <thead>
                <tr>
                  <th scope="col">Rank</th>
                  <th scope="col">Player</th>
                  <th scope="col">Time</th>
                  <th scope="col">Approvals</th>
                  <th scope="col">Max Pressure</th>
                </tr>
              </thead>
              <tbody id="leaderboard-list"></tbody>
            </table>
            <div class="status-subtext" id="leaderboard-empty">
              Loading top runs...
            </div>
          </div>
        </div>
      </div>

      <div class="how-to-win-overlay hidden" id="how-to-win-overlay">
        <div class="how-to-win-modal">
          <button class="modal-close" id="how-to-win-close-button">✕</button>
          <div class="intro-title">How to Win</div>
          <div class="intro-body">
            <p>
              Approve 25 tiles before time runs out while keeping both pressure
              meters below their thresholds. No tile is bad on its own; patterns
              are what cause incidents.
            </p>
            <h4>Patterns to Watch</h4>
            <p>
              <strong>Sameness (Hotspot):</strong> repeating the same request
              method or cluster builds concentration pressure.
            </p>
            <p>
              <strong>Burst (Volume):</strong> approving too quickly multiplies
              throughput pressure even if requests are diverse.
            </p>
            <p>
              <strong>Mixed:</strong> sameness plus burst spikes both meters
              fastest.
            </p>
          </div>
        </div>
      </div>

      <div class="tutorial-overlay hidden" id="tutorial-overlay">
        <div class="tutorial-modal">
          <button class="modal-close" id="tutorial-close-button">✕</button>
          <div class="intro-title" id="tutorial-title">Tutorial</div>
          <div class="intro-body" id="tutorial-body"></div>
          <div class="tutorial-footer">
            <div class="tutorial-step" id="tutorial-step"></div>
            <div class="tutorial-actions">
              <button class="restart-button" id="tutorial-prev-button">
                Back
              </button>
              <button class="restart-button" id="tutorial-next-button">
                Next
              </button>
            </div>
          </div>
        </div>
      </div>

      <div class="snake-overlay hidden" id="snake-overlay">
        <div class="snake-modal">
          <button class="modal-close" id="snake-close-button">✕</button>
          <div class="intro-title">Classic Snake</div>
          <div class="snake-body">
            <div class="snake-column">
              <div class="panel-title">Score</div>
              <div class="snake-score" id="snake-score">0</div>
              <div class="status-subtext">
                Best run: <span id="snake-best">0</span>
              </div>
              <div class="status-subtext" id="snake-status">Press Start</div>
              <div class="snake-actions">
                <button class="restart-button" id="snake-start-button">
                  Start
                </button>
                <button class="restart-button" id="snake-restart-button">
                  Restart
                </button>
              </div>
              <div class="snake-tip">
                Controls: Arrow keys / WASD or the pad.
              </div>
            </div>
            <div class="snake-board-wrapper">
              <div
                class="snake-grid"
                id="snake-grid"
                role="grid"
                aria-label="Snake grid"
              ></div>
              <div class="snake-legend">
                <span class="snake-chip snake-chip-head"></span>Head
                <span class="snake-chip snake-chip-body"></span>Body
                <span class="snake-chip snake-chip-food"></span>Food
              </div>
            </div>
            <div class="snake-pad">
              <div class="snake-pad-row">
                <button class="snake-pad-button" data-snake-dir="up">↑</button>
              </div>
              <div class="snake-pad-row">
                <button class="snake-pad-button" data-snake-dir="left">←</button>
                <button class="snake-pad-button" data-snake-dir="down">↓</button>
                <button class="snake-pad-button" data-snake-dir="right">→</button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <audio
      id="background-music"
      src="Mob Battle – Silent Partner (No Copyright Music).mp3"
      preload="auto"
      loop
    ></audio>

    <script src="snake-logic.js"></script>
    <script src="app.js"></script>
  </body>
</html>
